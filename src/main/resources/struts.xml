<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE struts PUBLIC
	"-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"
	"http://struts.apache.org/dtds/struts-2.5.dtd">
<struts>

  <constant name="struts.excludedClasses"
            value="
                java.lang.Object,
                java.lang.Runtime,
                java.lang.System,
                java.lang.Class,
                java.lang.ClassLoader,
                java.lang.ProcessBuilder,
                ognl.OgnlContext,
                ognl.ClassResolver,
                ognl.TypeConverter,
                ognl.MemberAccess,
                ognl.DefaultMemberAccess,
                com.opensymphony.xwork2.ognl.SecurityMemberAccess,
                com.opensymphony.xwork2.ActionContext" />

  <constant name="struts.enable.DynamicMethodInvocation" value="false"/>
  <constant name="struts.ui.theme" value="bootstrap"/>
  <constant name="struts.action.extension" value=""/>
  <constant name="struts.action.excludePattern" value="/_ah/.*,/favicon\.ico"/>
  <constant name="struts.convention.action.packages" value="com.gruuf.web.actions"/>
  <constant name="struts.convention.default.parent.package" value="gruufDefault"/>

  <bean type="com.opensymphony.xwork2.UnknownHandler" name="tiles-convention" class="com.gruuf.web.TilesUnknownHandler"/>

  <bean class="com.gruuf.services.UserStore"/>
  <bean class="com.gruuf.services.MailBox"/>

  <package name="gruufDefault" extends="struts-default">

    <result-types>
      <result-type name="tiles" class="org.apache.struts2.views.tiles.TilesResult" default="true" />
    </result-types>

    <interceptors>

      <interceptor name="login" class="com.gruuf.web.interceptors.LoginInterceptor"/>
      <interceptor name="user" class="com.gruuf.web.interceptors.UserInterceptor"/>
      <interceptor name="garage" class="com.gruuf.web.interceptors.GarageInterceptor"/>
      <interceptor name="bikeHistory" class="com.gruuf.web.interceptors.BikeHistoryInterceptor"/>
      <interceptor name="auth" class="com.gruuf.web.interceptors.AuthInterceptor"/>
      <interceptor name="secure" class="com.gruuf.web.interceptors.SecureInterceptor"/>

      <interceptor-stack name="gruufDefaultDev">
        <interceptor-ref name="exception"/>
        <interceptor-ref name="secure"/>
        <interceptor-ref name="login"/>
        <interceptor-ref name="auth"/>
        <interceptor-ref name="user"/>
        <interceptor-ref name="garage"/>
        <interceptor-ref name="bikeHistory"/>
        <interceptor-ref name="alias"/>
        <interceptor-ref name="servletConfig"/>
        <interceptor-ref name="i18n"/>
        <interceptor-ref name="prepare"/>
        <interceptor-ref name="params"/>
        <interceptor-ref name="conversionError"/>
        <interceptor-ref name="validation">
          <param name="excludeMethods">input,back,cancel,browse</param>
        </interceptor-ref>
        <interceptor-ref name="workflow">
          <param name="excludeMethods">input,back,cancel,browse</param>
        </interceptor-ref>
        <interceptor-ref name="debugging"/>
      </interceptor-stack>

      <interceptor-stack name="defaultWithMessages">
        <interceptor-ref name="gruufDefaultDev"/>
        <interceptor-ref name="store">
          <param name="operationMode">AUTOMATIC</param>
        </interceptor-ref>
      </interceptor-stack>
    </interceptors>

    <default-interceptor-ref name="gruufDefaultDev"/>

    <default-action-ref name="index"/>

    <global-results>
      <result name="https-redirect" type="redirect">
        <param name="location">https://gruuf.com/</param>
      </result>
      <result name="login" type="redirectAction">
        <param name="actionName">login</param>
        <param name="namespace">/</param>
      </result>
      <result name="garage" type="redirectAction">
        <param name="actionName">garage</param>
        <param name="namespace">/</param>
      </result>
    </global-results>

  </package>

  <unknown-handler-stack>
    <unknown-handler-ref name="tiles-convention"/>
  </unknown-handler-stack>

</struts>
